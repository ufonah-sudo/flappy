<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>Game Fullscreen</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* Принудительное растяжение на уровне браузера */
        :root {
            --tg-viewport-height: 100vh;
            --tg-viewport-stable-height: 100vh;
        }

        html, body {
            margin: 0 !important;
            padding: 0 !important;
            width: 100% !important;
            height: 100% !important;
            /* Хак для iOS Safari/Telegram */
            height: -webkit-fill-available !important; 
            overflow: hidden !important;
            position: fixed !important;
            inset: 0 !important;
            background-color: #4ec0ca !important;
        }

        #root {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            /* Тянем контейнер по реальной высоте вьюпорта */
            height: var(--tg-viewport-height, 100vh) !important;
            display: block !important;
            background-color: #4ec0ca;
            z-index: 1;
        }

        canvas {
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            display: block !important;
            object-fit: cover !important;
            z-index: 5;
        }

        /* Скрываем всё лишнее, что может давать отступы */
        #app-interface {
            position: absolute;
            inset: 0;
            z-index: 10;
            pointer-events: none;
        }

        .screen {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>
    <div id="root">
        <canvas id="game-canvas"></canvas>
        
        <div id="app-interface">
            <div id="scene-home" class="screen">
                <button id="btn-start" style="padding: 20px 40px; font-size: 20px; background: #f7d51d; border: none; border-radius: 10px;">
                    ИГРАТЬ
                </button>
            </div>
            
            <div id="scene-mode-selection" class="screen hidden">
                <button id="btn-mode-classic">CLASSIC</button>
                <button id="btn-mode-arcade">ARCADE</button>
            </div>

            <div id="game-over" class="screen hidden">
                <h1>GAME OVER</h1>
                <button onclick="location.reload()">RESTART</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { Game } from './game.js';
        import { ArcadeGame } from './arcade.js';

        const tg = window.Telegram.WebApp;

        function applyFullscreen() {
            tg.ready();
            tg.expand(); // Разворачиваем
            
            // Фикс высоты для CSS переменной
            const vh = window.innerHeight;
            document.documentElement.style.setProperty('--tg-viewport-height', `${vh}px`);
            
            // Красим системные области
            tg.setHeaderColor('#4ec0ca');
            tg.setBackgroundColor('#4ec0ca');
            
            window.scrollTo(0, 0);
        }

        // Запускаем несколько раз, чтобы "пробить" лаг Telegram
        applyFullscreen();
        window.addEventListener('resize', applyFullscreen);
        setTimeout(applyFullscreen, 500);

        // Инициализация игры
        const canvas = document.getElementById('game-canvas');
        const game = new Game(canvas, (score) => {
            document.getElementById('game-over').classList.remove('hidden');
        });

        document.getElementById('btn-start').onclick = () => {
            document.getElementById('scene-home').classList.add('hidden');
            game.start();
        };

        // Принудительный ресайз канваса под экран
        game.resize();
    </script>
</body>
</html>